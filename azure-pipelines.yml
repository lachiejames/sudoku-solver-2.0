name: $(Rev:r:)

variables:
  FlutterChannel: "stable"
  FlutterVersion: "latest"
  FlutterPath: /Users/runner/hostedtoolcache/Flutter/1.20.3-stable/macos/flutter

jobs:
  - job: Test
    pool:
      vmImage: "macOS-latest"
    steps:
      - task: Cache@2
        inputs:
          key: myFlutterKey
          restoreKeys: myFlutterKey
          path: "$(FlutterPath)"
          cacheHitVar: FLUTTER_CACHE_RESTORED

      - task: FlutterInstall@0
        displayName: Setup flutter
        inputs:
          channel: "$(FlutterChannel)"
          version: "$(FlutterVersion)"
        condition: ne(variables.FLUTTER_CACHE_RESTORED, 'true')

      - task: PowerShell@2
        displayName: Setup environment
        inputs:
          targetType: "inline"
          script: |
            Write-Host "##vso[task.prependpath]$(JAVA_HOME_11_X64)"
            Write-Host "##vso[task.setvariable variable=JAVA_HOME;]$(JAVA_HOME_11_X64)"
            Write-Host "##vso[task.prependpath]$(FlutterPath)"
            Write-Host "##vso[task.prependpath]$(FlutterPath)/cache/dart-sdk/bin"

      - task: CmdLine@2
        displayName: Run install
        inputs:
          script: "flutter pub get"

      - task: CmdLine@2
        displayName: Run test
        inputs:
          script: "flutter test"

      - task: CmdLine@2
        displayName: do stuff
        inputs:
          script: "echo $PATH"
  #   - task: Cache@2
  #     inputs:
  #       key: emulatorKey
  #       restoreKeys: emulatorKey
  #       path: $ANDROID_HOME
  #       cacheHitVar: EMULATOR_CACHE_RESTORED

  #   - script: azure/pipelines/scripts.sh setup_emulator
  #     displayName: Setup Emulator
  #     condition: ne(variables.EMULATOR_CACHE_RESTORED, 'true')

  #   - script: azure/pipelines/scripts.sh run_integration_tests
  #     displayName: Run Integration Tests


